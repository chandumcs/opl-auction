<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèè OPL 2025 ‚Äî Live Auction</title>
<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:#f4f7fc;
  color:#002244;
}
header{
  background:#052f57;
  color:#fff;
  text-align:center;
  padding:15px;
  font-size:20px;
  font-weight:600;
}
.container{
  max-width:950px;
  background:white;
  margin:30px auto;
  border-radius:15px;
  padding:25px;
  box-shadow:0 6px 20px rgba(0,0,0,0.1);
  text-align:center;
}
.price{
  font-size:45px;
  color:orange;
  margin:10px;
  font-weight:bold;
}
.owner-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(130px,1fr));
  gap:12px;
  margin-top:20px;
}
.owner{
  background:#003366;
  color:white;
  border-radius:8px;
  padding:10px;
}
footer{
  background:#052f57;
  color:white;
  text-align:center;
  padding:15px;
  margin-top:30px;
}

/* Search box */
.search-section {
  margin: 20px auto;
  text-align: center;
}
input[type="text"] {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  text-align: center;
  font-size: 15px;
  width: 250px;
}
button {
  border: none;
  cursor: pointer;
  font-size: 15px;
  padding: 10px 15px;
  border-radius: 8px;
  margin: 5px;
  transition: 0.2s;
}
.btn-blue { background: #007bff; color: white; }
.btn-blue:hover { background: #005ec4; }

.player-result {
  margin-top: 20px;
  padding: 15px;
  background: #e9f2ff;
  border-radius: 10px;
  display: none;
}
.player-result h3 {
  margin: 5px 0;
  color: #052f57;
}
.player-result p {
  margin: 3px 0;
}
</style>
</head>
<body>
<header>üé• OPL 2025 ‚Äî Live Auction Feed</header>

<div class="container">
  <h2 id="livePlayer">Waiting for next player...</h2>
  <p id="liveType">---</p>
  <h1 id="liveBid">‚Çπ0</h1>
  <h3 id="liveOwner">---</h3>

  <h3 style="margin-top:30px;">Owners & Remaining Wallets</h3>
  <div id="liveOwners" class="owner-grid"></div>

  <!-- üîç Player Search Section -->
  <div class="search-section">
    <h3>Search Player Details</h3>
    <input type="text" id="searchPlayer" placeholder="Enter Player Name">
    <button class="btn-blue" onclick="searchPlayer()">Search</button>
    <div id="playerResult" class="player-result">
      <h3 id="resName"></h3>
      <p id="resType"></p>
      <p id="resCategory"></p>
      <p id="resOwner"></p>
      <p id="resPrice"></p>
    </div>
  </div>
</div>

<footer>¬© 2025 Olive Crypto Systems Pvt. Ltd.</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, get, child } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDw6bKSkntytlnKFGCW5OTwiv44vE5sIxY",
  authDomain: "opl-2025-season-2.firebaseapp.com",
  databaseURL: "https://opl-2025-season-2-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "opl-2025-season-2",
  storageBucket: "opl-2025-season-2.firebasestorage.app",
  messagingSenderId: "282929654033",
  appId: "1:282929654033:web:535ab2b78937cdfa2b04b0"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// üî¥ LIVE UPDATES SECTION
const auctionRef = ref(db,"auction/current");
onValue(auctionRef,(snapshot)=>{
  const data=snapshot.val();
  if(data){
    const p=data.currentPlayer;
    const o=data.owners;

    document.getElementById("livePlayer").innerText=p.name;
    document.getElementById("liveType").innerText=`Type: ${p.type}`;
    document.getElementById("liveBid").innerText=`‚Çπ${p.soldPrice.toLocaleString()}`;
    document.getElementById("liveOwner").innerText=`Sold to: ${p.owner}`;

    const c=document.getElementById("liveOwners");
    c.innerHTML="";
    Object.entries(o).forEach(([name,balance])=>{
      const d=document.createElement("div");
      d.className="owner";
      d.innerHTML=`<b>${name}</b><br><small>‚Çπ${(balance/10000000).toFixed(2)} Cr</small>`;
      c.appendChild(d);
    });
  }
});

// üîç PLAYER SEARCH FUNCTION
async function searchPlayer(){
  const name=document.getElementById("searchPlayer").value.trim().toLowerCase();
  const resultBox=document.getElementById("playerResult");
  if(!name){ alert("Please enter a player name"); return; }

  const snapshot = await get(ref(db,"auction/history"));
  if(snapshot.exists()){
    const data = snapshot.val();
    let found = null;
    Object.values(data).forEach(player=>{
      if(player.name && player.name.toLowerCase().includes(name)){
        found = player;
      }
    });

    if(found){
      resultBox.style.display="block";
      document.getElementById("resName").innerText=found.name;
      document.getElementById("resType").innerText=`Type: ${found.type}`;
      document.getElementById("resCategory").innerText=`Category: ${found.category || "-"}`;
      document.getElementById("resOwner").innerText=`Owner: ${found.owner}`;
      document.getElementById("resPrice").innerText=`Sold Price: ‚Çπ${found.soldPrice.toLocaleString()}`;
    } else {
      resultBox.style.display="block";
      document.getElementById("playerResult").innerHTML=`<p>No player found</p>`;
    }
  } else {
    alert("No player data found in Firebase yet!");
  }
}
</script>
</body>
</html>

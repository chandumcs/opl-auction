<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üèè OPL 2025 ‚Äî Live Auction Viewer</title>
<style>
  :root{--nav:#002d62;--accent:#ff9800;--blue:#007bff;--bg:#eef3fa}
  body{font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);margin:0}
  header{background:var(--nav);color:#fff;padding:14px 0;text-align:center;font-weight:700}
  .container{max-width:1000px;margin:26px auto;padding:28px;background:#fff;border-radius:12px;box-shadow:0 8px 24px rgba(2,20,56,.08)}
  h3{margin:0 0 8px}
  .muted{color:#475569}
  .price{font-size:40px;color:orange;font-weight:700;margin:8px 0}
  .stats{display:flex;flex-wrap:wrap;justify-content:space-around;gap:10px;margin-top:18px}
  .card{background:#002d62;color:#fff;border-radius:10px;padding:10px 20px;text-align:center;min-width:160px}
  table{width:100%;border-collapse:collapse;margin-top:25px}
  th,td{border:1px solid #ddd;padding:8px;text-align:left}
  th{background:#002d62;color:#fff}
  tr:nth-child(even){background:#f9f9f9}
  .filter-section{display:flex;justify-content:space-between;align-items:center;margin-top:15px}
  select{padding:8px 10px;border-radius:6px;border:1px solid #cfd8e3}
  footer{background:var(--nav);color:#fff;text-align:center;padding:12px;margin-top:26px}
  .player-box{border:2px solid #002d62;padding:18px;border-radius:10px;text-align:center;margin-bottom:25px}
</style>
</head>
<body>
<header>üèè OPL 2025 ‚Äî Live Auction Viewer</header>

<div class="container">
  <div class="player-box">
    <h3 id="playerName">Waiting for next player...</h3>
    <div id="playerMeta" class="muted">---</div>
    <div class="price" id="currentBid">‚Çπ0</div>
    <div id="topBidder" class="muted">Top Bidder: ---</div>
  </div>

  <div class="filter-section">
    <input id="searchPlayer" type="text" placeholder="Search player name..." style="padding:8px;width:220px;border-radius:6px;border:1px solid #ccc">
    <div>
      <label>Filter by Owner: </label>
      <select id="ownerFilter">
        <option value="All">All Owners</option>
      </select>
    </div>
  </div>

  <table id="soldTable">
    <thead>
      <tr>
        <th>Player Name</th>
        <th>Type</th>
        <th>Category</th>
        <th>Location</th>
        <th>Sold Price (‚Çπ)</th>
        <th>Owner</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="stats" id="ownerStats"></div>
</div>

<footer>¬© 2025 Olive Crypto Systems Pvt. Ltd.</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDw6bKSkntytlnKFGCW5OTwiv44vE5sIxY",
  authDomain: "opl-2025-season-2.firebaseapp.com",
  databaseURL: "https://opl-2025-season-2-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "opl-2025-season-2",
  storageBucket: "opl-2025-season-2.firebasestorage.app",
  messagingSenderId: "282929654033",
  appId: "1:282929654033:web:535ab2b78937cdfa2b04b0"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const playerNameEl = document.getElementById("playerName");
const playerMetaEl = document.getElementById("playerMeta");
const currentBidEl = document.getElementById("currentBid");
const topBidderEl = document.getElementById("topBidder");
const soldTableBody = document.querySelector("#soldTable tbody");
const ownerFilter = document.getElementById("ownerFilter");
const ownerStatsDiv = document.getElementById("ownerStats");
const searchPlayer = document.getElementById("searchPlayer");

let soldPlayers = {};

// Listen live
onValue(ref(db, "/live"), (snap) => {
  const live = snap.val();
  if (!live) return;
  playerNameEl.textContent = live.name || "Waiting for next player...";
  playerMetaEl.textContent = `Type: ${live.type || "---"} | ${live.basePrice || "---"} | ${live.location || "---"}`;
  currentBidEl.textContent = "‚Çπ" + (live.currentBid || 0).toLocaleString();
  topBidderEl.textContent = "Top Bidder: " + (live.topBidder || "---");
});

// Listen sold
onValue(ref(db, "/sold"), (snap) => {
  soldPlayers = snap.exists() ? snap.val() : {};
  renderTable();
  renderStats();
});

function renderTable() {
  const filter = ownerFilter.value;
  const search = searchPlayer.value.toLowerCase();
  const list = Object.values(soldPlayers).filter(p => 
    (filter === "All" || p.owner === filter) &&
    (!search || p.name.toLowerCase().includes(search))
  );
  soldTableBody.innerHTML = "";
  list.forEach(p => {
    const row = `<tr>
      <td>${p.name}</td>
      <td>${p.type}</td>
      <td>${p.basePrice}</td>
      <td>${p.location}</td>
      <td>‚Çπ${p.soldPrice.toLocaleString()}</td>
      <td>${p.owner}</td>
    </tr>`;
    soldTableBody.insertAdjacentHTML("beforeend", row);
  });

  // Populate owner dropdown
  const owners = [...new Set(Object.values(soldPlayers).map(p => p.owner))];
  ownerFilter.innerHTML = '<option value="All">All Owners</option>';
  owners.forEach(o => {
    const opt = document.createElement("option");
    opt.value = o;
    opt.textContent = o;
    ownerFilter.appendChild(opt);
  });
}

// Calculate and show owner stats
function renderStats() {
  const stats = {};
  Object.values(soldPlayers).forEach(p => {
    if (!p.owner) return;
    if (!stats[p.owner]) stats[p.owner] = { total: 0, count: 0 };
    stats[p.owner].total += p.soldPrice;
    stats[p.owner].count += 1;
  });

  ownerStatsDiv.innerHTML = "";
  Object.entries(stats).forEach(([owner, { total, count }]) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<b>${owner}</b><br>${count} Players<br>Spent ‚Çπ${(total/10000000).toFixed(2)} Cr`;
    ownerStatsDiv.appendChild(div);
  });
}

ownerFilter.onchange = renderTable;
searchPlayer.oninput = renderTable;
</script>
</body>
</html>

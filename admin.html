<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OPL 2025 ‚Äî Admin Control</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f5f8ff;margin:0;text-align:center}
    header{background:#002b5c;color:#fff;padding:12px;display:flex;align-items:center;gap:10px}
    header img{height:40px}
    .wrap{max-width:1100px;margin:20px auto;padding:10px}
    .card{background:#fff;padding:20px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,0.08);margin-bottom:20px}
    .amount{font-size:36px;color:#ff6600;font-weight:700}
    .owner-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:15px auto;max-width:900px}
    .owner{background:#002b5c;color:#fff;border-radius:8px;padding:10px;cursor:pointer}
    .owner small{display:block;color:#ffb74d}
    .wallet{font-size:13px;margin-top:4px;color:#b9ff9f}
    input[type=text]{padding:8px;border-radius:5px;border:1px solid #ccc;width:300px}
    button{padding:8px 12px;border:none;border-radius:5px;margin:4px;cursor:pointer}
    .inc{background:#eee}
    .sell{background:#00a651;color:#fff}
    .suggest{position:relative;width:300px;margin:0 auto}
    #suggestions{position:absolute;top:38px;left:0;right:0;background:#fff;border:1px solid #ccc;border-radius:5px;z-index:10}
    #suggestions div{padding:8px;text-align:left;cursor:pointer}
    #suggestions div:hover{background:#f2f2f2}
    .sold-card{background:#fff;border-left:5px solid #00a651;padding:10px;border-radius:6px;margin-bottom:8px;text-align:left}
    footer{background:#002b5c;color:#fff;padding:10px}
  </style>
</head>
<body>
<header>
  <img src="assets/logo.png" alt="Olive">
  <h2>Olive Premier League 2025 ‚Äî Admin Control</h2>
</header>

<div class="wrap">
  <div class="card">
    <h3>Current Player</h3>
    <div><b>Name:</b> <span id="playerName">‚Äî</span></div>
    <div><b>Type:</b> <span id="playerType">‚Äî</span></div>
    <div><b>Class:</b> <span id="playerClass">‚Äî</span></div>
    <div><b>Location:</b> <span id="playerLocation">‚Äî</span></div>
    <div><b>Base Price:</b> ‚Çπ<span id="basePrice">0</span></div>
    <div class="amount" id="currentBid">‚Çπ0</div>
    <div><b>Top Bidder:</b> <span id="currentBidder">‚Äî</span></div>

    <div class="suggest">
      <input type="text" id="searchInput" placeholder="Search player by name..." onkeyup="showSuggestions()" />
      <div id="suggestions"></div>
    </div>

    <div class="owner-grid" id="ownerGrid"></div>

    <div>
      <button class="inc" onclick="increaseBid(100000)">+1L</button>
      <button class="inc" onclick="increaseBid(500000)">+5L</button>
      <button class="inc" onclick="increaseBid(1000000)">+10L</button>
      <button class="inc" onclick="increaseBid(2500000)">+25L</button>
      <button class="inc" onclick="increaseBid(5000000)">+50L</button>
      <button class="inc" onclick="increaseBid(10000000)">+1Cr</button>
      <button class="sell" onclick="markSold()">Mark Sold</button>
    </div>
  </div>

  <div class="card">
    <h3>üèè Sold Players / Auction History</h3>
    <div id="soldList"></div>
  </div>
</div>

<footer>¬© 2025 Olive Crypto Systems Pvt. Ltd.</footer>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey:"AIzaSyDw6bKSkntytlnKFGCW5OTwiv44vE5sIxY",
  authDomain:"opl-2025-season-2.firebaseapp.com",
  databaseURL:"https://opl-2025-season-2-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"opl-2025-season-2",
  storageBucket:"opl-2025-season-2.firebasestorage.app",
  messagingSenderId:"282929654033",
  appId:"1:282929654033:web:535ab2b78937cdfa2b04b0",
  measurementId:"G-WT75JLVR2E"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// Initial owners (deductions applied)
const initialOwners={
 "Sharath":{captain:"Kalyan",wallet:64.5},
 "Sarath Chava":{captain:"Sai",wallet:77},
 "Teja":{captain:"Shashank",wallet:74.5},
 "Vamsi":{captain:"Surender",wallet:69.5},
 "Rajan":{captain:"Vamsi",wallet:62},
 "Shabeer":{captain:"Vijayander",wallet:70},
 "Ravi Raj":{captain:"Suresh",wallet:75},
 "Mahinder":{captain:"Sai Varma",wallet:66}
};
const crToRs=c=>Math.round(c*10000000);
function initOwners(){
  Object.entries(initialOwners).forEach(([n,o])=>{
    const ref=db.ref("owners/"+n);
    ref.get().then(s=>{if(!s.exists())ref.set({captain:o.captain,wallet:crToRs(o.wallet)})});
  });
}
function loadOwners(){
  const grid=document.getElementById("ownerGrid");
  grid.innerHTML="";
  Object.keys(initialOwners).forEach(n=>{
    const d=document.createElement("div");
    d.className="owner";
    d.innerHTML=`${n}<small>${initialOwners[n].captain}</small><div class="wallet" id="wallet-${n}">‚Äî</div>`;
    d.onclick=()=>selectBidder(n);
    grid.appendChild(d);
  });
  db.ref("owners").on("value",s=>{
    const v=s.val()||{};
    Object.keys(v).forEach(k=>{
      const el=document.getElementById("wallet-"+k);
      if(el)el.innerText="‚Çπ"+(v[k].wallet||0).toLocaleString()+" ("+(v[k].wallet/10000000).toFixed(2)+"Cr)";
    });
  });
}
let allPlayers={},selKey=null,currentBid=0,bidder=null;
db.ref("players").on("value",s=>{allPlayers=s.val()||{}});
function showSuggestions(){
  const q=document.getElementById("searchInput").value.toLowerCase();
  const box=document.getElementById("suggestions");
  box.innerHTML="";
  if(!q)return;
  Object.entries(allPlayers).forEach(([k,p])=>{
    if(p.name&&p.name.toLowerCase().includes(q)){
      const div=document.createElement("div");
      div.textContent=p.name+" ("+(p.type||"")+")";
      div.onclick=()=>selectPlayer(k,p);
      box.appendChild(div);
    }
  });
}
function selectPlayer(k,p){
  selKey=k;currentBid=p.currentBid||0;
  document.getElementById("playerName").innerText=p.name;
  document.getElementById("playerType").innerText=p.type||"-";
  document.getElementById("playerClass").innerText=p.category||"-";
  document.getElementById("playerLocation").innerText=p.location||"-";
  document.getElementById("basePrice").innerText=p.basePrice||0;
  document.getElementById("currentBid").innerText="‚Çπ"+currentBid.toLocaleString();
  db.ref("live").set({currentPlayer:p,currentBid, currentBidder:null});
  document.getElementById("suggestions").innerHTML="";
}
function selectBidder(n){
  bidder=n;
  document.getElementById("currentBidder").innerText=n;
  db.ref("live/currentBidder").set(n);
}
function increaseBid(a){
  if(!selKey)return alert("Select player");
  if(!bidder)return alert("Select owner");
  db.ref("owners/"+bidder+"/wallet").get().then(s=>{
    const w=s.val()?.wallet||0;
    if(w<currentBid+a)return alert("Not enough balance");
    currentBid+=a;
    document.getElementById("currentBid").innerText="‚Çπ"+currentBid.toLocaleString();
    db.ref("live/currentBid").set(currentBid);
  });
}
function markSold(){
  if(!selKey||!bidder)return alert("Select player & bidder");
  const own=db.ref("owners/"+bidder+"/wallet");
  own.transaction(cur=>{
    if(cur===null||cur<currentBid)return;
    return cur-currentBid;
  },(e,c,snap)=>{
    if(!c)return alert("Wallet insufficient");
    const p=allPlayers[selKey];
    p.currentBid=currentBid;p.team=bidder;p.status="sold";p.soldTime=new Date().toISOString();
    db.ref("players/"+selKey).update(p);
    db.ref("soldPlayers").push(p);
    db.ref("live").set({});
    alert(`${p.name} SOLD to ${bidder} for ‚Çπ${currentBid.toLocaleString()}`);
  });
}
db.ref("soldPlayers").on("value",s=>{
  const list=document.getElementById("soldList");list.innerHTML="";
  if(!s.exists())return;
  Object.values(s.val()).reverse().forEach(p=>{
    const d=document.createElement("div");
    d.className="sold-card";
    d.innerHTML=`<b>${p.name}</b> (${p.type}) ‚Äî ‚Çπ${(p.currentBid||0).toLocaleString()} | <b>${p.team}</b>`;
    list.appendChild(d);
  });
});
initOwners();loadOwners();
</script>
</body>
</html>

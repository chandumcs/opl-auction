<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OPL 2025 — Admin Control</title>

  <link rel="stylesheet" href="styles.css" />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body>
  <!-- HEADER -->
  <header class="topbar">
    <div style="display:flex;align-items:center;">
      <img src="assets/logo.png" alt="Olive" class="logo" />
      <h1>OPL 2025 — Admin Control Panel</h1>
    </div>
  </header>

  <section class="current-player">
    <div class="current-card">
      <h2 id="admin-player-name">Select Player to Start Auction</h2>
      <p>Employee ID: <span id="admin-player-id">---</span></p>
      <div class="big-price">₹<span id="admin-current-bid">0</span></div>
      <p>Bidder: <strong id="admin-current-bidder">---</strong></p>
    </div>
  </section>

  <section style="text-align:center;">
    <input id="bidderName" placeholder="Enter Team/Owner name" style="padding:8px;border-radius:6px;border:1px solid #ccc;" />
    <button onclick="increaseBid(100)" style="margin:5px;padding:8px 12px;">+100</button>
    <button onclick="increaseBid(500)" style="margin:5px;padding:8px 12px;">+500</button>
    <button onclick="increaseBid(1000)" style="margin:5px;padding:8px 12px;">+1000</button>
    <button onclick="markSold()" style="background:#22C55E;color:white;padding:8px 16px;border:none;border-radius:6px;">Mark Sold</button>
  </section>

  <hr style="margin:20px 0;">

  <section class="grid" id="admin-players-grid">
    <!-- Player list -->
  </section>

  <footer class="footer">
    © 2025 Olive Crypto Systems Pvt. Ltd. — OPL 2025 Admin Control
  </footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDw6bKsn...EsIxY",
      authDomain: "opl-2025-season-2.firebaseapp.com",
      databaseURL: "https://opl-2025-season-2-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "opl-2025-season-2",
      storageBucket: "opl-2025-season-2.appspot.com",
      messagingSenderId: "282929654033",
      appId: "1:282929654033:web:8c51d8414ef45f442b04b0",
      measurementId: "G-20BWK7G44S"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentPlayer = null;

    const playerName = document.getElementById('admin-player-name');
    const playerId = document.getElementById('admin-player-id');
    const currentBid = document.getElementById('admin-current-bid');
    const bidderField = document.getElementById('admin-current-bidder');
    const playersGrid = document.getElementById('admin-players-grid');

    // Load all players for admin view
    db.ref('players').on('value', snapshot => {
      const players = snapshot.val();
      playersGrid.innerHTML = '';

      for (let id in players) {
        const p = players[id];
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <div class="player-name">${p.name}</div>
          <div class="prices">
            <span>Base ₹${p.basePrice}</span>
            <span>Bid ₹${p.currentBid}</span>
          </div>
          <div class="status ${p.status}">${p.status.toUpperCase()}</div>
        `;
        div.onclick = () => selectPlayer(id, p);
        playersGrid.appendChild(div);
      }
    });

    function selectPlayer(id, p) {
      currentPlayer = id;
      playerName.textContent = p.name;
      playerId.textContent = id;
      currentBid.textContent = p.currentBid;
      bidderField.textContent = p.currentBidder || "---";

      db.ref('currentAuction').set({
        employeeId: id,
        name: p.name,
        currentBid: p.currentBid,
        currentBidder: p.currentBidder || ""
      });

      db.ref('players/' + id).update({ status: 'live' });
    }

    function increaseBid(amount) {
      if (!currentPlayer) return alert("Select a player first!");
      const bidder = document.getElementById('bidderName').value.trim();
      if (!bidder) return alert("Enter bidder name!");

      const newBid = parseInt(currentBid.textContent) + amount;
      currentBid.textContent = newBid;
      bidderField.textContent = bidder;

      db.ref('players/' + currentPlayer).update({
        currentBid: newBid,
        currentBidder: bidder,
        status: 'live'
      });

      db.ref('currentAuction').update({
        currentBid: newBid,
        currentBidder: bidder
      });
    }

    function markSold() {
      if (!currentPlayer) return alert("Select a player first!");
      const bidder = bidderField.textContent;

      db.ref('players/' + currentPlayer).update({
        status: 'sold',
        soldTo: bidder
      });

      db.ref('currentAuction').set({
        name: playerName.textContent + " (SOLD)",
        employeeId: currentPlayer,
        currentBid: currentBid.textContent,
        currentBidder: bidder
      });

      alert(playerName.textContent + " SOLD to " + bidder + " for ₹" + currentBid.textContent);
      currentPlayer = null;
      playerName.textContent = "Select Player to Start Auction";
      playerId.textContent = "---";
      currentBid.textContent = "0";
      bidderField.textContent = "---";
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OPL 2025 ‚Äî Admin Control Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f5f8ff; margin: 0; padding: 0; text-align: center; }
    header { background: #002b5c; color: white; padding: 10px 20px; display: flex; align-items: center; }
    header img { height: 40px; margin-right: 10px; }
    .card { background: white; width: 80%; margin: 30px auto; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .amount { font-size: 45px; color: orange; font-weight: bold; }
    .owner-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 25px auto; width: 80%; }
    .owner { background: #002b5c; color: white; border-radius: 8px; padding: 10px; font-weight: bold; cursor: pointer; transition: 0.2s; }
    .owner:hover { background: #004080; }
    .owner small { display: block; color: #ffb74d; font-size: 13px; }
    button { border: none; padding: 10px 15px; border-radius: 5px; margin: 5px; cursor: pointer; font-weight: bold; }
    .bid-btn { background: #eee; }
    .bid-btn:hover { background: #ccc; }
    .mark-sold { background: #00a651; color: white; }
    .search-box { position: relative; width: 300px; margin: 0 auto; }
    #searchInput { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    #suggestions { position: absolute; top: 40px; left: 0; right: 0; background: white; border: 1px solid #ccc; border-radius: 5px; z-index: 10; }
    #suggestions div { padding: 8px; cursor: pointer; text-align: left; }
    #suggestions div:hover { background: #f0f0f0; }
    .history { margin-top: 40px; }
    .sold-card { background: white; border-left: 5px solid #00a651; margin: 10px auto; width: 70%; padding: 10px; border-radius: 8px; text-align: left; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    footer { background: #002b5c; color: white; padding: 10px; font-size: 14px; margin-top: 50px; }
  </style>
</head>
<body>
  <header>
    <img src="assets/logo.png" alt="Olive Logo">
    <h2>OPL 2025 ‚Äî Admin Control Panel</h2>
  </header>

  <div class="card">
    <h2>Select Player to Start Auction</h2>
    <p>Name: <span id="playerName">---</span></p>
    <p>Type: <span id="playerType">---</span></p>
    <p>Class: <span id="playerClass">---</span></p>
    <p>Location: <span id="playerLocation">---</span></p>
    <p>Base Price: ‚Çπ<span id="basePrice">0</span></p>
    <div class="amount" id="currentBid">‚Çπ0</div>
    <p>Bidder: <span id="currentBidder">---</span></p>

    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search Player by Name" onkeyup="showSuggestions()" autocomplete="off"/>
      <div id="suggestions"></div>
    </div>

    <div class="owner-grid" id="ownerGrid"></div>

    <div>
      <button class="bid-btn" onclick="increaseBid(100000)">+1 Lakh</button>
      <button class="bid-btn" onclick="increaseBid(500000)">+5 Lakh</button>
      <button class="bid-btn" onclick="increaseBid(1000000)">+10 Lakh</button>
      <button class="bid-btn" onclick="increaseBid(2500000)">+25 Lakh</button>
      <button class="bid-btn" onclick="increaseBid(5000000)">+50 Lakh</button>
      <button class="bid-btn" onclick="increaseBid(10000000)">+1 Crore</button>
    </div>

    <button class="mark-sold" onclick="markSold()">Mark Sold</button>
  </div>

  <div class="history">
    <h3>üèè Last Sold Players</h3>
    <div id="soldList"></div>
  </div>

  <footer>¬© 2025 Olive Crypto Systems Pvt. Ltd. ‚Äî OPL 2025 Admin Control</footer>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDw6bKSkntytlnKFGCW5OTwiv44vE5sIxY",
      authDomain: "opl-2025-season-2.firebaseapp.com",
      databaseURL: "https://opl-2025-season-2-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "opl-2025-season-2",
      storageBucket: "opl-2025-season-2.firebasestorage.app",
      messagingSenderId: "282929654033",
      appId: "1:282929654033:web:535ab2b78937cdfa2b04b0",
      measurementId: "G-WT75JLVR2E"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const owners = [
      { owner: "Sharath", captain: "Kalyan" },
      { owner: "Teja", captain: "Shashank" },
      { owner: "Rajan", captain: "Vamsi" },
      { owner: "Shabeer", captain: "Vijayander" },
      { owner: "Sarath Chava", captain: "Sai" },
      { owner: "Mahinder", captain: "Sai Varma" },
      { owner: "Vamsi", captain: "Surender" },
      { owner: "Ravi Raj", captain: "Suresh" }
    ];

    let allPlayers = {};
    let currentPlayerKey = null;
    let currentBid = 0;
    let currentBidder = null;

    function loadOwners() {
      const grid = document.getElementById("ownerGrid");
      owners.forEach(o => {
        const div = document.createElement("div");
        div.classList.add("owner");
        div.innerHTML = `${o.owner}<small>${o.captain}</small>`;
        div.onclick = () => selectBidder(o.owner);
        grid.appendChild(div);
      });
    }

    function selectBidder(name) {
      currentBidder = name;
      document.getElementById("currentBidder").innerText = name;
      // Broadcast live bidder update
      db.ref("live/currentBidder").set(name);
    }

    // Load all players initially
    db.ref("players").once("value").then(snapshot => {
      if (snapshot.exists()) allPlayers = snapshot.val();
    });

    function showSuggestions() {
      const input = document.getElementById("searchInput").value.toLowerCase();
      const suggestionBox = document.getElementById("suggestions");
      suggestionBox.innerHTML = "";
      if (!input) return;

      const matches = Object.entries(allPlayers).filter(([key, player]) =>
        player.name && player.name.toLowerCase().includes(input)
      );

      matches.slice(0, 10).forEach(([key, player]) => {
        const div = document.createElement("div");
        div.textContent = `${player.name} (${player.type})`;
        div.onclick = () => selectPlayer(key, player);
        suggestionBox.appendChild(div);
      });
    }

    function selectPlayer(key, player) {
      currentPlayerKey = key;
      currentBid = player.currentBid || 0;
      document.getElementById("playerName").innerText = player.name;
      document.getElementById("playerType").innerText = player.type;
      document.getElementById("playerClass").innerText = player.category;
      document.getElementById("playerLocation").innerText = player.location;
      document.getElementById("basePrice").innerText = player.basePrice;
      document.getElementById("currentBid").innerText = "‚Çπ" + currentBid.toLocaleString();
      document.getElementById("currentBidder").innerText = player.team || "---";
      document.getElementById("suggestions").innerHTML = "";
      document.getElementById("searchInput").value = player.name;

      // Broadcast selected player to live
      db.ref("live/currentPlayer").set(player);
    }

    function increaseBid(amount) {
      if (!currentPlayerKey) return alert("Search and select a player first!");
      if (!currentBidder) return alert("Select an owner before bidding!");
      currentBid += amount;
      document.getElementById("currentBid").innerText = "‚Çπ" + currentBid.toLocaleString();

      // Broadcast bid live
      db.ref("live/currentBid").set(currentBid);
    }

    function markSold() {
      if (!currentPlayerKey || !currentBidder) return alert("Select player and bidder first!");
      const playerData = {
        ...allPlayers[currentPlayerKey],
        currentBid,
        team: currentBidder,
        status: "sold",
        soldTime: new Date().toISOString()
      };
      // Update in players
      db.ref("players/" + currentPlayerKey).update(playerData);
      // Add to soldPlayers
      db.ref("soldPlayers").push(playerData);
      // Broadcast reset
      db.ref("live").set({});

      alert("‚úÖ Player marked as SOLD!");
      resetUI();
    }

    function resetUI() {
      currentPlayerKey = null;
      currentBidder = null;
      currentBid = 0;
      document.getElementById("playerName").innerText = "---";
      document.getElementById("playerType").innerText = "---";
      document.getElementById("playerClass").innerText = "---";
      document.getElementById("playerLocation").innerText = "---";
      document.getElementById("basePrice").innerText = "0";
      document.getElementById("currentBid").innerText = "‚Çπ0";
      document.getElementById("currentBidder").innerText = "---";
      document.getElementById("searchInput").value = "";
      document.getElementById("suggestions").innerHTML = "";
    }

    // Show live sold list
    db.ref("soldPlayers").on("value", snapshot => {
      const soldList = document.getElementById("soldList");
      soldList.innerHTML = "";
      if (snapshot.exists()) {
        const soldPlayers = Object.values(snapshot.val()).reverse();
        soldPlayers.forEach(p => {
          const div = document.createElement("div");
          div.classList.add("sold-card");
          div.innerHTML = `<b>${p.name}</b> (${p.type}) ‚Äî ‚Çπ${p.currentBid.toLocaleString()} | <b>${p.team}</b>`;
          soldList.appendChild(div);
        });
      }
    });

    loadOwners();
  </script>
</body>
</html>
